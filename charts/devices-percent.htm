<div class='row trunk-section'>
    <div class='col-lg-12 text-left' id='devices_percent'></div>
    <div class='btn-group btn-group-sm text-center split-by-controls'>
      <button type='button' class='btn btn-default active' data-x_accessor='release'>Release</button>
      <button type='button' class='btn btn-default' data-x_accessor='beta'>Beta</button>
      <button type='button' class='btn btn-default' data-x_accessor='aurora'>Aurora</button>
      <button type='button' class='btn btn-default' data-x_accessor='nightly'>Nightly</button>
    </div>
</div>

<script>
var globals = {};

var split_by_params = {
  title: "Percent of devices by channel",
  width: 1140,
  height: 300,
  right: 40,
  target: document.getElementById('devices_percent'),
  y_accessor:"device_id",
  x_accessor:"release",
  chart_type: "bar"
};

$('.split-by-controls button').click(function() {
    var new_x_accessor = $(this).data('x_accessor');
    split_by_params.x_accessor = setX(new_x_accessor);
    // change button state
    $(this).addClass('active').siblings().removeClass('active');

    // update data
    delete split_by_params.xax_format;
    MG.data_graphic(split_by_params);
});

function setX(channel) {
  if (channel == "nightly") {
    x_accessor = 'nightly';
  } else if (channel == "aurora") {
    x_accessor = 'aurora';
  } else if (channel == "beta") {
    x_accessor = 'beta';
  } else if (channel == "release") {
    x_accessor = 'release';
  } else {
    x_accessor = 'release';
  }
  return x_accessor;
}

d3.json('data/devices.json', function(data) {
  for (i=0; i<data.length; i++) {
    data[i]['device_id'] = data[i]['device_id'].toString();
  }
  globals.data = data;
  split_by_params.data = data;
  split_by_params.x_accessor = setX();
  MG.data_graphic(split_by_params);
});
</script>
